\documentclass[english]{article}

\usepackage{graphicx}
\usepackage{alltt}
\usepackage{url}
%\usepackage{ngerman}
\usepackage{color}
\usepackage{enumitem}
\usepackage{listings}



\title{\huge\sffamily\bfseries Review of Group 4 by Group 1}
\author{Cyrill Kr\"ahenb\"uhl \and Silvan Egli \and Lukas Bischofberger}
\date{\today}


\begin{document}
\maketitle

%% **** please observe the page limit ****
%% (it is not allowed to change the font size or page geometry to gain more space!)
%% comment or remove lines below before hand-in
\begin{center}
{\large\textcolor{red}{Page limit: 18 pages.}}
\end{center}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tableofcontents
\pagebreak



\section{Background}

\noindent {\bf Developers of the external system:} {\it x', y', z', ...} \\

\noindent {\bf Date of the review:} ...


\section{Report and Design Review}

Study the documentation that came with the external system and evaluation. 

\subsection{System Architecture and Security Concepts}

Is the chosen architecture well-suited for the tasks specified in the requirements? Are the security design decisions well motivated and justified? List positive and negative aspects for each question.


\subsection{Risk Analysis}

Is the risk analysis coherent and complete? That is, are all relevant assets, threat sources, and threats listed? 
%
Are the risk definitions (likelihood, impact, and risk) reasonable?
%
Are the countermeasures appropriate?
2.4.5 -2 -> HTTPS does not prevent MITM attack

\section{Implementation Review}
 
\subsection{Compliance with Requirements} 

%Does the system meet the functional and security requirements given in the assignment? Are they implemented correctly? If not, list any missing functionality %or security measure.
In the following we will analyze the implementation of the functional and security requirements given in the project assignment.

\subsubsection{Functional Requirements}

\begin{enumerate}

\item \textbf{Certificate Issuing}
\item \textbf{Certificate Revocation} 
\item \textbf{CA Administrator Interface}
\item \textbf{Key Backup}
\item \textbf{System Administration and Maintenance}
\end{enumerate}
\subsubsection{Security Requirements}
\begin{enumerate}

\item \textbf{Access Control with regard to CA Functionality and Data}
\item \textbf{Secrecy and Integrity for Private Keys in Backup}
\item \textbf{Secrecy and Integrity for User Data}
\item \textbf{Access Control on all Components}
\begin{enumerate}[label=(\alph*)]
\item \textbf{Firewall}:
\item \textbf{Webbox}:
\item \textbf{Sqlbox}:
\item \textbf{Logbox}:
\end{enumerate}
\end{enumerate}
\subsubsection*{Observations}
input/request: unusual username ( $<$script$>$alert(1)$<$/script$>$)/ request certificate\\
output/response:  certificate request error containing sh exception as html comment $<$ !-- /bin/sh syntax error .... --$>$\\
input/request: shell code as username (Vorname) e.g \$(/bin/ls) then request certificate
output: certificate with evaluated expression in Organizational unit (OU) e.g. app -> backdoor


\subsection{System Security Testing}

%Systematically investigate the system. Are the countermeasures implemented as %described? Do you see any security problems? Analyze the system using both %black-box as well as white-box testing.

\subsubsection{Countermeasures}
In this section we will discuss the implementation of the proposed countermeasures in the risk analysis. The number after each countermeasure corresponds to the number in the risk analysis.

\paragraph{WebServer}
\begin{enumerate}[label=(\alph*)] \item \textbf{FDE\footnote{\url{https://en.wikipedia.org/wiki/Disk_encryption}}}:
\item \textbf{DDOS (2)}
\item \textbf{Monitor Intrusion and Attacks (4)}:
\item \textbf{Monitoring Logs (5)}:
\end{enumerate} 

\paragraph{Private Keys}
\begin{enumerate}[label=(\alph*)]
\item \textbf{Access Control (1)}:
\item \textbf{HTTPS (2)}:
\item \textbf{Notification Channel for Irregularities (3)}
\end{enumerate} 

\paragraph{User Data}
\begin{enumerate}[label=(\alph*)]
\item \textbf{Access Control (1)}:
\item \textbf{HTTPS (2)}:
\item \textbf{Notification Channel for Irregularities (3)}
\end{enumerate} 


\subsubsection{Testing}

Black box testing
\begin{itemize}
	
	\item Nessus scanner
	\item nmap -> 12345 is open UDP
	\item ZAP
	\item By Hand

\end{itemize}

White box testing

\begin{itemize}
	\item Firewall: 12345 -> to webbox\\ openssh-sftp-server installed,  
\end{itemize}



\subsection{Backdoors}

%Describe all backdoors that you found on the system. It may be that you also %find unintended backdoors (only the group's presentation will show whether %they were intended or not).

\subsubsection{Command Injection}
Command injection is an attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application \footnote{\url{https://www.owasp.org/index.php/Command_Injection}}.\\
 When issuing a new user certificate, the Flask application takes the information on the user from the database and creates an openssl system command in the form of a string. This command is then executed by making use of Python's subprocess module \footnote{\url{https://docs.python.org/2/library/subprocess.html}} with the privileges of the Flask application (caweb user). The certificate's subject field contains an organizationalUnitName (OU) attribute which maps to the user's first name. 
 
 \paragraph{Vulnerability:}
 The vulnerability arises from two inattentions:
\begin{enumerate}
\item \textbf{Insufficient user input validation:} The only restriction on the user's first name is the length of 64 characters. Appart from that any string is allowed.
\item \textbf{shell=True:} Setting shell=True in Python's subprocess module makes the command beeing executed through the shell, allowing any useage of shell supported features such as command substitution. 
\end{enumerate}

\paragraph{Exploit:}
The space of possible commands beeing executed by any user is only limited by the privileges of the caweb user. As an example: by setting the first name to the following string 
\begin{lstlisting}[language=bash]
$(grep -rw secret_key app/|sed 's/\ /*/g;s/\//*/g'\)
\end{lstlisting}
we were able to compromise the applications secret key. The command will be substituted as shell=True is set and the result is used as input for the OU attribute in the certificates subject field.

\paragraph{Mitigation:} The vulnerability could be mitigated by
\begin{enumerate}
\item Properly sanitize the user's input by allowing only alphanumerical characters for example. Note that this should be done on any field not only first name as they are vulnerable too. 
\item Setting shell=False in the subprocess module and therefore disable all shell based features. In case the application relies on any shell based features it should use the wrappers provided by python. (e.g. os.walk())
\end{enumerate}

\subsection{UDP Port}
The UDP port 12345 is open on the firewall and nated to the webserver. There a script in /home/admin/.hidden is listening on that port. Reverse engineering didn't show the specific packet which needs to be sent to open a shell on the webserver.

\section{Comparison}

Compare your system with the external system you were given for the review. Are there any remarkable highlights in your system or the external system?


\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../../book"
%%% End: 

%Maybe useful : https://netsec.ws/?p=309
